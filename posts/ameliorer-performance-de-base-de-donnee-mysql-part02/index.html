<!doctype html><html lang=fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Améliorer la performance de votre base de donnée MySQL (Partie 02) | Les amis de Percona</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Comment améliorer la performance de votre base de donnée MySQL en heure de pointe?"><meta name=generator content="Hugo 0.80.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/ananke/css/main.min.css><link rel="shortcut icon" href=/img/favicon.png type=image/x-icon><meta property="og:title" content="Améliorer la performance de  votre base de donnée MySQL (Partie 02)"><meta property="og:description" content="Comment améliorer la performance de votre base de donnée MySQL en heure de pointe?"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lesamisdepercona.fr/posts/ameliorer-performance-de-base-de-donnee-mysql-part02/"><meta property="article:published_time" content="2021-04-20T11:43:01+04:00"><meta property="article:modified_time" content="2021-04-20T11:43:01+04:00"><meta itemprop=name content="Améliorer la performance de  votre base de donnée MySQL (Partie 02)"><meta itemprop=description content="Comment améliorer la performance de votre base de donnée MySQL en heure de pointe?"><meta itemprop=datePublished content="2021-04-20T11:43:01+04:00"><meta itemprop=dateModified content="2021-04-20T11:43:01+04:00"><meta itemprop=wordCount content="1905"><meta itemprop=keywords content="mysql,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Améliorer la performance de  votre base de donnée MySQL (Partie 02)"><meta name=twitter:description content="Comment améliorer la performance de votre base de donnée MySQL en heure de pointe?"><script async src="https://www.googletagmanager.com/gtag/js?id=G-W9SYN1YL24"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-W9SYN1YL24');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-203534013-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-203534013-1');</script></head><body class="ma0 avenir bg-near-white"><header><div class=bg-dark-blue><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib"><img src=/img/logo.png class="w100 mw5-ns" alt="Les amis de Percona"></a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Articles page">Articles</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="Qui Sommes Nous? page">Qui Sommes Nous?</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/tags/ title="Tags page">Tags</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://www.lesamisdepercona.fr/posts/ameliorer-performance-de-base-de-donnee-mysql-part02/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://www.lesamisdepercona.fr/posts/ameliorer-performance-de-base-de-donnee-mysql-part02/&text=Am%c3%a9liorer%20la%20performance%20de%20%20votre%20base%20de%20donn%c3%a9e%20MySQL%20%28Partie%2002%29" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.lesamisdepercona.fr/posts/ameliorer-performance-de-base-de-donnee-mysql-part02/&title=Am%c3%a9liorer%20la%20performance%20de%20%20votre%20base%20de%20donn%c3%a9e%20MySQL%20%28Partie%2002%29" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Améliorer la performance de votre base de donnée MySQL (Partie 02)</h1><p class=tracked>By <strong>Francis</strong></p><time class="f6 mv4 dib tracked" datetime=2021-04-20T11:43:01+04:00>April 20, 2021</time>
<span class="f6 mv4 dib tracked">- 9 minutes read</span>
<span class="f6 mv4 dib tracked">- 1905 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-100-l"><h3 id=les-18-choses-que-vous-pouvez-faire-pour-supprimer-les-goulots-d39étranglement-mysql-causés-par-un-trafic-élevé-partie-02>Les 18 choses que vous pouvez faire pour supprimer les goulots d'étranglement MySQL causés par un trafic élevé (Partie 02)</h3><p><em>Il s'agit d'une série de blogs en trois parties qui se concentre sur la gestion d'un événement inattendu à fort trafic au fur et à mesure qu'il se produit. La première partie peut être consultée <a href=/posts/article02-mysql-18astuces-heure-de-pointe-part1/>ici</a> et la troisième partie se trouve <a href=/posts/article02-mysql-18astuces-heure-de-pointe-part3/>ici</a>.</em></p><p><strong>7. Obtenez plus de mémoire</strong></p><p><em>Complexité: faible</em></p><p><em>Impact potentiel: élevé</em></p><p>Si vos données ne bénéficient pas suffisamment assez de mémoire, vos performances MySQL seront très limitées. Si vos données s'intègrent déjà bien, l'ajout d'encore plus de mémoire n'améliorera pas ses performances.</p><p>Même si vous utilisez un stockage très rapide, tel qu'Intel Optane ou un stockage NVMe directement connecté, l'accès aux données en mémoire est un atout majeur.</p><p>Comment savoir si vous avez suffisamment de mémoire? Regardez l'utilisation de la mémoire et l'I/O activity.</p><p><img src=/posts/article02/p02_image01.png alt="image 01"></p><p>L'I/O activity est en fait le premier élément que je voudrais examiner. Si, comme dans le cas ci-dessus, vous n'avez pas de « Read I/O » à proprement parler, toutes vos données sont dans le cache - que ce soit les caches de données de MySQL ou le cache de fichiers du système d'exploitation. Cependant, le « write activity » ne sera pas complètement éliminée même si toutes les données tiennent dans le cache car les modifications de la base de données doivent être enregistrées sur le disque.</p><p>En règle générale, vous ne chercherez pas à éliminer complètement Read IO - Dans la plupart des cas, cela nécessitera trop de mémoire et inutile. Cependant, vous voulez vous assurer que Read IO n'affecte pas considérablement vos performances. Vous pouvez le faire en vous assurant que votre volume de disque est gérable. Si vous avez <a href=https://www.percona.com/software/database-tools/percona-monitoring-and-management>Percona Monitoring and Management (PMM)</a>, vous pouvez vérifier dans quelle mesure les lectures de disque affectent les performances de vos requêtes spécifiques dans Query Analytics.</p><p><img src=/posts/article02/p02_image02.png alt="image 02"></p><p>Remarque: Bien que vous puissiez obtenir une certaine valeur en ajoutant simplement plus de mémoire, elle sera utilisée par le système d'exploitation comme cache. Pour obtenir la plupart de la mémoire nouvellement disponible, vous devez configurer MySQL pour pouvoir l'utiliser. Innodb_buffer_pool_size est la variable la plus importante à considérer. 80% de la mémoire est souvent utilisée en règle générale, mais <a href=https://www.percona.com/blog/2015/06/02/80-ram-tune-innodb_buffer_pool_size/>il y en a d'autres</a>.</p><p>Une chose à laquelle vous devez prêter attention, lorsque vous configurez MySQL pour tirer profit de toute votre mémoire, est de vous assurer que vous ne surchargez pas la mémoire et que MySQL ne manque pas de mémoire virtuelle (car il peut planter ou tomber hors service à cause du « Out of Memory ( OOM) Killer »).</p><p><img src=/posts/article02/p02_image03.png alt="image 03"></p><p>Vous devriez également vous assurer qu'il n'y a pas d'activité d'échange significative (1 Mo/s ou plus) même si une certaine utilisation de l'espace d'échange est normale. Consultez "<a href=https://chrisdown.name/2018/01/02/in-defence-of-swap.html>In defense of swap: common misconceptions</a>" pour plus de détails.</p><p><img src=/posts/article02/p02_image04.png alt="image 04"></p><p><strong>8. Passer à un stockage plus rapide</strong></p><p><em>Complexité: moyenne</em></p><p><em>Impact potentiel: élevé</em></p><p>Lorsque la taille de vos données est petite, les mettre en mémoire est le meilleur moyen de lecture. Si votre base de données est volumineuse, cela peut devenir peu pratique et un disque plus rapide pourrait être indispensable. En plus, il y aura des écritures qui doivent être gérées même si vous avez beaucoup de mémoire. Cet article ancien mais toujours valable entre dans <a href=https://www.percona.com/blog/2010/04/08/fast-ssd-or-more-memory/>les détails sur ce sujet</a>.</p><p>Avec les processeurs, vous devez savoir qu'à chaque fois que vous avez besoin de plus de cœurs ou de cœurs plus rapides, le stockage devient beaucoup plus compliqué. Vous devez comprendre la différence entre le débit (IOPS) et la latence (<a href=https://louwrentius.com/understanding-storage-performance-iops-and-latency.html>consultez cet article fantastique sur le sujet</a>) ainsi que la différence entre les performances de lecture et d'écriture.</p><p>Une façon d'examiner les performances IO consiste à examiner le nombre de stockage IOPS servi ou la bande passante de l'activité d'IO.</p><p><img src=/posts/article02/p02_image05.png alt="image 05"></p><p>Il est très utile de connaitre les limites de votre stockage et de savoir si vous en êtes proche ou que vous y êtes confronté. Vous ne connaissez peut-être pas les performances exactes du stockage. Dans ce cas, il est recommandé de jeter un œil sur <strong>Disk IO Load</strong> qui vous montre approximativement combien d'opérations IO sont en cours.</p><p><img src=/posts/article02/p02_image06.png alt="image 06"></p><p>Si vous voyez ce nombre en dizaines ou en centaines, il est probable que votre disque soit surchargé. Le problème avec le stockage, contrairement au CPU, est que nous n'avons aucun moyen de savoir quel est le «niveau naturel de concurrence», quand-est-ce-que les requêtes peuvent se dérouler en parallèle ou quand-est-ce-que la mise en file d'attente doit avoir lieu.</p><p><img src=/posts/article02/p02_image07.png alt="image 07"></p><p>Jetez un œil à la latence des demandes pour les lectures et les écritures pour voir s'il y a une différence par rapport à la situation avant le pic de trafic. En outre, les latences de lecture et d'écriture peuvent être affectées indépendamment et doivent être examinées séparément.</p><p>Dans quelle mesure un disque plus rapide peut-il avoir un impact sur les performances de vos requêtes? Du point de vue des lectures, vous pouvez vérifier l'analyse des Query Analytics PMM comme je l'ai expliqué dans la <strong>section 7. Obtenir plus de mémoire</strong> , mais pour les écritures, c'est plus compliqué.</p><p>Écrire dans InnoDB Redo Log, ou plus précisément, le conserver sur le disque via fsync () est un goulot d'étranglement très courant. Vous verrez si cela se produit dans votre système en regardant le nombre de fsyncs en attente (tableau de bord MySQL Innodb Details, Section Innodb Disk IO).</p><p><img src=/posts/article02/p02_image08.png alt="image 08"></p><p>S'il est proche de 1 tout le temps, vous avez probablement un goulot d'étranglement avec le débordement du disque. Pour améliorer la situation, vous aurez besoin d'un stockage avec une meilleure latence d'écriture (fsync ()). Vous pouvez ajuster votre configuration MySQL pour réduire la garantie de durabilité ou ajuster votre volume de travail pour regrouper les requêtes en un plus petit nombre de transactions.</p><p>Quelles options de stockage plus rapides sont disponibles? Intel Optane SSD ou NVMe storage a tendance à offrir les meilleures performances et une latence aussi rapide que prévisible. Cependant, si vous utilisez ces solutions, en particulier dans le cloud, assurez-vous d'utiliser une forme de réplication pour la redondance des données.</p><p>Si vous devez utiliser le stockage réseau, recherchez des options optimisées pour le débit, telles que le <a href=https://louwrentius.com/understanding-storage-performance-iops-and-latency.html>type de volume EBS io1</a> AWS. Les gp2 volumes traditionnels «à usage général» peuvent être beaucoup plus rentables, mais ils ont une pointe de performances relativement inférieures.</p><p><strong>9. Vérifiez votre réseau</strong></p><p><em>Complexité: faible</em></p><p><em>Impact potentiel: élevé</em></p><p>Pour vérifier si un réseau est un goulot d'étranglement dans votre trafic en heure de pointe, vous devez examiner la bande passante, la latence et les erreurs.</p><p>Les réseaux ont tendance à être plus compliqués que les autres ressources, car toutes ces ressources doivent être mesurées séparément pour différents clients. Par exemple, les clients qui opèrent sur «localhost» ont tendance à ne pas avoir de problème, cependant, les clients situés dans d'autres parties du monde et communiquant avec votre base de données auront des problèmes.</p><p>Il est rare que la bande passante du réseau, du moins en ce qui concerne le nœud local, soit un problème.</p><p><img src=/posts/article02/p02_image09.png alt="image 09"></p><p>Rarement, les applications récupèrent des ensembles de résultats volumineux et saturent le réseau. Les sauvegardes réseau et autres transferts de données volumineux peuvent saturer le réseau, entraînant ainsi la lenteur des autres transactions des utilisateurs.</p><p>La latence entre votre client et le serveur de base de données peut être approximativement mesurée par l'outil «ping» ou «mtr». Si vous avez un réseau de 10 Go, vous pouvez vous attendre à 0,2 ms dans le même centre de données. Il est généralement légèrement plus élevé chez les fournisseurs de cloud au sein de la même zone de disponibilité. Différentes zones à haute disponibilité ont une latence plus élevée et la latence entre les régions distantes peut atteindre 100 ms avec une variance beaucoup plus élevée que le réseau local.</p><p><img src=/posts/article02/p02_image10.png alt="image 10"></p><p>Dans ce cas, nous voyons que le chemin entre le client et le serveur passe par un seul routeur (et peut-être quelques commutateurs) avec une latence moyenne de 1,5 ms et aucun paquet perdu.</p><p>Vous devez garder votre serveur d'applications et votre base de données aussi proches que possible - dans la même zone de disponibilité si possible, mais sûrement dans la même région pour les applications sensibles à la latence.</p><p>En ce qui concerne les erreurs, la retransmission TCP est votre pire ennemi car elle peut ajouter une latence très importante.
<img src=/posts/article02/p02_image11.png alt="image 11"></p><p>Si vous constatez une augmentation des taux de retransmission pendant les heures de pointe, il y a des chances qu'il y ait des problèmes au niveau du réseau qui doivent être résolus.</p><p><strong>10. Localisez et optimisez les requêtes à l'origine de la charge</strong></p><p><em>Complexité: moyenne</em></p><p><em>Impact potentiel: élevé</em></p><p>La localisation et l'optimisation des mauvaises requêtes est l'une des activités les plus rentables que vous puissiez faire car elle offre des avantages à long terme. Contrairement au renforcement de votre matériel, il ne nécessite aucun investissement supplémentaire (autre que du temps).</p><p>Si vous exécutez <a href=https://www.percona.com/software/database-tools/percona-monitoring-and-management>Percona Monitoring and Management</a>, vous devez jeter un œil à l'outil d'analyse des requêtes, qui trie par défaut les requêtes en fonction de la charge qu'elles génèrent.</p><p><img src=/posts/article02/p02_image12.png alt="image 12"></p><p>Examiner et optimiser les requêtes dans cet ordre est un moyen fantastique de rendre votre système plus rapide. Dans certains cas, comme la requête de validation, vous ne pouvez pas vraiment optimiser la requête elle-même, mais vous pouvez l'accélérer grâce à des modifications matérielles ou à la configuration de MySQL.</p><p>Consultez les détails de l'exécution de la requête:</p><p><img src=/posts/article02/p02_image13.png alt="image 13"></p><p>Et lisez l'explication pour voir si et comment cette requête peut être optimisée:
<img src=/posts/article02/p02_image14.png alt="image 14"></p><p>L'optimisation des requêtes MySQL est un sujet trop complexe pour être traité dans un seul article de blog. J'envisagerais d'apprendre à lire <a href=https://dev.mysql.com/doc/refman/8.0/en/explain.html>EXPLAIN</a> et d'assister à un <a href=https://www.percona.com/resources/webinars/how-analyze-and-tune-mysql-queries-better-performance>webinar</a>.</p><p><strong>11. Ajouter des index manquants</strong></p><p><em>Complexité: faible</em></p><p><em>Impact potentiel: élevé</em></p><p>L'optimisation complète des requêtes peut nécessiter des modifications de la façon dont une requête est écrite, ce qui nécessite du temps de développement et de test qui peut être difficile à obtenir. C'est pourquoi, lors du premier passage, vous souhaiterez peut-être vous concentrer uniquement sur l'ajout d'index manquants. Cela ne nécessite pas de modifications d'application et c'est raisonnablement sûr (à de rares exceptions près), et ne devrait pas modifier les résultats de la requête.</p><p>Consultez ce <a href=https://www.percona.com/resources/mysql-videos/mysql-indexing-best-practices-mysql-56>webinar</a> pour plus de détails.</p><p><strong>12. Supprimer les index inutiles</strong></p><p><em>Complexité: moyenne</em></p><p><em>Impact potentiel: moyen</em></p><p>Au fil du temps, il est très courant que le schéma de base de données accumule des index dupliqués, redondants ou inutilisés. Certains sont ajoutés par erreur ou par malentendu, d'autres ont été utiles dans le passé, mais ne le sont plus lorsque l'application a changé.</p><p>Vous pouvez en savoir plus sur les index redondants et dupliqués dans cet <a href=https://www.percona.com/blog/2012/06/20/find-and-remove-duplicate-indexes/>article de blog</a>. Le vérificateur de clé <a href=https://www.percona.com/doc/percona-toolkit/LATEST/pt-duplicate-key-checker.html>pt-duplicate-key</a> de Percona Toolkit est également un excellent outil pour les trouver.</p><p>Un index inutilisé est à la fois un peu plus compliqué et risqué - ce n'est pas parce qu'il n'y a pas eu de requête nécessitant cet index la semaine dernière qu'il n'y a pas de rapport mensuel ou trimestriel qui en a besoin.</p><p>L'article de blog, <a href=https://www.percona.com/blog/2016/09/09/basic-housekeeping-for-mysql-indexes/>Basic Housekeeping for MySQL Indexes</a>, fournit une recette sur la façon de trouver de tels index. Si vous exécutez MySQL 8, vous pouvez envisager de <a href=https://dev.mysql.com/doc/refman/8.0/en/invisible-indexes.html>rendre un tel index invisible</a> pendant un certain temps avant de le supprimer.</p><p>Il s'agit d'une série de blogs en trois parties. La première partie peut être trouvée ici, et la troisième partie peut être trouvée ici.</p><p>Page source : <a href=https://www.percona.com/blog/2020/04/06/18-things-you-can-do-to-remove-mysql-bottlenecks-caused-by-high-traffic-part-two/>Percona Blog</a></p><ul class=pa0><li class=list><a href=/tags/mysql class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">mysql</a></li></ul><div class="mt6 instapaper_ignoref"></div></div></article></main><footer class="bg-dark-blue bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.lesamisdepercona.fr/>&copy; Les amis de Percona 2022</a><div></div></div></footer></body></html>