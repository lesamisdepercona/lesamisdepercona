<!doctype html><html lang=fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Sécurité de la base de données PostgreSQL : OS - Authentification | Les amis de Percona</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Traduit à partir de l'article de Ibrar Ahmed intitulé, PostgreSQL Database Security: OS – Authentication"><meta name=generator content="Hugo 0.80.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/ananke/css/main.min.css><link rel="shortcut icon" href=/img/favicon.png type=image/x-icon><meta property="og:title" content="Sécurité de la base de données PostgreSQL : OS - Authentification"><meta property="og:description" content="Traduit à partir de l'article de Ibrar Ahmed intitulé, PostgreSQL Database Security: OS – Authentication"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lesamisdepercona.fr/posts/securite-de-la-base-de-donnees-postgresql-os-authentification/"><meta property="og:image" content="https://www.lesamisdepercona.fr/thumbnail/thumbnailarticle19.jpg"><meta property="article:published_time" content="2021-10-10T11:43:01+04:00"><meta property="article:modified_time" content="2021-10-10T11:43:01+04:00"><meta itemprop=name content="Sécurité de la base de données PostgreSQL : OS - Authentification"><meta itemprop=description content="Traduit à partir de l'article de Ibrar Ahmed intitulé, PostgreSQL Database Security: OS – Authentication"><meta itemprop=datePublished content="2021-10-10T11:43:01+04:00"><meta itemprop=dateModified content="2021-10-10T11:43:01+04:00"><meta itemprop=wordCount content="1324"><meta itemprop=image content="https://www.lesamisdepercona.fr/thumbnail/thumbnailarticle19.jpg"><meta itemprop=keywords content="PostgreSQL,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.lesamisdepercona.fr/thumbnail/thumbnailarticle19.jpg"><meta name=twitter:title content="Sécurité de la base de données PostgreSQL : OS - Authentification"><meta name=twitter:description content="Traduit à partir de l'article de Ibrar Ahmed intitulé, PostgreSQL Database Security: OS – Authentication"><script async src="https://www.googletagmanager.com/gtag/js?id=G-W9SYN1YL24"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-W9SYN1YL24');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-203534013-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-203534013-1');</script></head><body class="ma0 avenir bg-near-white"><header><div class=bg-dark-blue><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib"><img src=/img/logo.png class="w100 mw5-ns" alt="Les amis de Percona"></a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Articles page">Articles</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="Qui Sommes Nous? page">Qui Sommes Nous?</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/tags/ title="Tags page">Tags</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://www.lesamisdepercona.fr/posts/securite-de-la-base-de-donnees-postgresql-os-authentification/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://www.lesamisdepercona.fr/posts/securite-de-la-base-de-donnees-postgresql-os-authentification/&text=S%c3%a9curit%c3%a9%20de%20la%20base%20de%20donn%c3%a9es%20PostgreSQL%c2%a0:%20OS%20-%20Authentification" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.lesamisdepercona.fr/posts/securite-de-la-base-de-donnees-postgresql-os-authentification/&title=S%c3%a9curit%c3%a9%20de%20la%20base%20de%20donn%c3%a9es%20PostgreSQL%c2%a0:%20OS%20-%20Authentification" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Sécurité de la base de données PostgreSQL : OS - Authentification</h1><p class=tracked>By <strong>Francis</strong></p><time class="f6 mv4 dib tracked" datetime=2021-10-10T11:43:01+04:00>October 10, 2021</time>
<span class="f6 mv4 dib tracked">- 7 minutes read</span>
<span class="f6 mv4 dib tracked">- 1324 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-100-l"><p>La sécurité est l&rsquo;affaire de tous lorsqu&rsquo;on parle de données et d&rsquo;informations, et elle devient donc le fondement principal de chaque base de données. La sécurité signifie protéger vos données contre les accès non autorisés. Cela signifie que seuls les utilisateurs autorisés peuvent se connecter à un système appelé authentification; un utilisateur ne peut faire que ce qu&rsquo;il est autorisé à faire (autorisation) et enregistrer l&rsquo;activité de l&rsquo;utilisateur (comptabilité). Je les ai expliqués dans mon article principal sur la sécurité, <a href=https://www.percona.com/blog/2021/01/04/postgresql-database-security-what-you-need-to-know/>PostgreSQL Database Security: What You Need To Know</a> . </p><p>Lorsque nous parlons de sécurité, l&rsquo;authentification est la première ligne de défense. PostgreSQL fournit diverses méthodes d&rsquo;authentification, qui sont classées en trois catégories.</p><ul><li><a href=https://www.percona.com/blog/2021/02/01/postgresql-database-security-authentication/>Authentification interne PostgreSQL </a></li><li>Authentification basée sur le système d&rsquo;exploitation</li><li>Authentification basée sur un serveur externe </li></ul><p>Dans la plupart des cas, PostgreSQL est configuré pour être utilisé avec une authentification interne. Par conséquent, j&rsquo;ai discuté de toutes les authentifications internes dans le précédent <a href=https://www.percona.com/blog/2021/02/01/postgresql-database-security-authentication/>article de blog</a> que j&rsquo;ai mentionné ci-dessus. Dans ce blog, nous discuterons des méthodes d&rsquo;authentification basées sur le système d&rsquo;exploitation pour PostgreSQL. Il existe trois méthodes pour effectuer une authentification basée sur le système d&rsquo;exploitation.</p><ul><li><a href=https://www.postgresql.org/docs/current/auth-ident.html>Identifiant</a></li><li><a href=https://www.postgresql.org/docs/current/auth-pam.html>PAM (Pluggable Authentication Modules)</a></li><li><a href=https://www.postgresql.org/docs/current/auth-ident.html>Peer</a></li></ul><h2 id=identifiant---ident>Identifiant - Ident</h2><p>L&rsquo;authentification d&rsquo;identification ne prend en charge que les connexions TCP/IP. Son serveur d&rsquo;identification fournit un mécanisme pour mapper le nom d&rsquo;utilisateur du système d&rsquo;exploitation du client sur le nom d&rsquo;utilisateur de la base de données. Il a également la possibilité de mapper le nom d&rsquo;utilisateur.</p><pre><code># TYPE  DATABASE        USER            ADDRESS                 METHOD
# &quot;local&quot; is for Unix domain socket connections only
local   all             all                                     trust
# IPv4 local connections:
host    all             all             127.0.0.1/32            ident
# IPv6 local connections:
host    all             all             ::1/128                 trust
# Allow replication connections from localhost, by a user with the
</code></pre><pre><code>$ psql postgres -h 127.0.0.1 -U postgres
psql: error: connection to server at &quot;127.0.0.1&quot;, port 5432 failed: FATAL:  Ident authentication failed for user &quot;postgres&quot;
</code></pre><p>Si aucun serveur ident n&rsquo;est installé, vous devrez installer l' <em><strong>ident2</strong></em> sur votre box ubuntu ou <em><strong>oidentd</strong></em> sur CentOS 7. Une fois que vous avez téléchargé et configuré le serveur ident, il est maintenant temps de configurer PostgreSQL. Cela commence par la création d&rsquo;une carte utilisateur dans le fichier &ldquo;pg_ident.conf&rdquo;.</p><pre><code># Put your actual configuration here
# ----------------------------------
# MAPNAME       SYSTEM-USERNAME         PG-USERNAME
PG_USER         vagrant                 postgres
</code></pre><p>Ici, nous avons mappé notre utilisateur système « vagrant » avec « postgres » de PostgreSQL. Il est temps de se connecter à l&rsquo;aide de l&rsquo;utilisateur vagrant.</p><pre><code>$ psql postgres -h 127.0.0.1 -U postgres
psql (15devel)
Type &quot;help&quot; for help.

postgres=#
</code></pre><p><a href=https://www.postgresql.org/docs/current/auth-ident.html><em>Remarque : Le protocole d&rsquo;identification n&rsquo;est pas conçu comme un protocole d&rsquo;autorisation ou de contrôle d&rsquo;accès.</em></a></p><h2 id=pam-pluggable-authentication-modules>PAM (Pluggable Authentication Modules)</h2><p>L&rsquo;authentification PAM fonctionne de la même manière que les « mots de passe ». Vous devrez créer un fichier de service PAM qui devrait activer l&rsquo;authentification basée sur PAM. Le nom du service doit être défini sur « PostgreSQL ».</p><p>Une fois le service créé, <a href=https://www.kernel.org/pub/linux/libs/pam/>PAM</a> peut désormais valider les pairs noms d&rsquo;utilisateur/mot de passe et éventuellement le nom d&rsquo;hôte distant ou l&rsquo;adresse IP connecté. L&rsquo;utilisateur doit déjà exister dans la base de données pour que l&rsquo;authentification PAM fonctionne.</p><pre><code>$ psql postgres -h 127.0.0.1 -U postgres
Password for user postgres: 
2021-08-11 13:16:38.332 UTC [13828] LOG:  pam_authenticate failed: Authentication failure
2021-08-11 13:16:38.332 UTC [13828] FATAL:  PAM authentication failed for user &quot;postgres&quot;
2021-08-11 13:16:38.332 UTC [13828] DETAIL:  Connection matched pg_hba.conf line 91: &quot;host    all             all             127.0.0.1/32            pam&quot;
psql: error: connection to server at &quot;127.0.0.1&quot;, port 5432 failed: FATAL:  PAM authentication failed for user &quot;postgres&quot;
</code></pre><p>Assurez-vous que le serveur PostgreSQL prend en charge l&rsquo;authentification PAM. C&rsquo;est une option de compilation qui doit être définie lorsque les binaires du serveur ont été construits. Vous pouvez vérifier si votre serveur PostgreSQL prend en charge l&rsquo;authentification PAM à l&rsquo;aide de la commande suivante.</p><pre><code>$ pg_config | grep with-pam

CONFIGURE =  '--enable-tap-tests' '--enable-cassert' '--prefix=/usr/local/pgsql/' '--with-pam'
</code></pre><p>S&rsquo;il n&rsquo;y a pas de fichier de serveur PAM pour PostgreSQL sous /etc/pam.d, vous devrez le créer manuellement. Vous pouvez choisir n&rsquo;importe quel nom pour le fichier ; cependant, je préfère l&rsquo;appeler &ldquo;postgresql&rdquo;.</p><pre><code>$ /etc/pam.d/PostgreSQL

@include common-auth
@include common-account
@include common-session
@include common-password
</code></pre><p>Étant donné que l&rsquo;utilisateur PostgreSQL ne peut pas lire les fichiers de mots de passe, installez sssd ( <a href=https://sssd.io/>SSSD - System Security Services Daemon</a> ) pour contourner cette limitation.</p><pre><code>sudo apt-get install sssd
</code></pre><p>Ajoutez postgresql à « ad_gpo_map_remote_interactive » à « /etc/sssd/sssd.conf »</p><pre><code>$ cat /etc/sssd/sssd.conf
ad_gpo_map_remote_interactive = +postgresql
</code></pre><p>Démarrez le service sssd et vérifiez qu&rsquo;il a correctement démarré.</p><pre><code>$ sudo systemctl start sssd
$ sudo systemctl status sssd
sssd.service - System Security Services Daemon
     Loaded: loaded (/lib/systemd/system/sssd.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2021-08-11 16:18:41 UTC; 12min ago
   Main PID: 1393 (sssd)
      Tasks: 2 (limit: 1071)
     Memory: 5.7M
     CGroup: /system.slice/sssd.service
             ├─1393 /usr/sbin/sssd -i --logger=files
             └─1394 /usr/libexec/sssd/sssd_be --domain shadowutils --uid 0 --gid 0 --logger=files
</code></pre><p>Il est temps maintenant de configurer pg_hba.conf pour utiliser l&rsquo;authentification PAM. Nous devons spécifier le nom du service PAM (pamservice) dans le cadre des options d&rsquo;authentification. Cela devrait être le même que le fichier que vous avez créé dans le dossier /etc/pam.d, qui dans mon cas est postgresql.</p><pre><code># &quot;local&quot; is for Unix domain socket connections only
local   all             all                                     trust
# IPv4 local connections:
host    all             all             127.0.0.1/32            pam pamservice=postgresql
# IPv6 local connections:
host    all             all             ::1/128                 trust
# Allow replication connections from localhost, by a user with the
</code></pre><p>Il faut maintenant recharger (ou redémarrer) le serveur PostgreSQL. Après cela, vous pouvez essayer de vous connecter au serveur PostgreSQL.</p><pre><code>vagrant@ubuntu-focal:~$ psql postgres -h 127.0.0.1 -U postgres
psql (15devel)
Type &quot;help&quot; for help.
postgres=&gt;
</code></pre><p>Note</p><p><a href=https://www.postgresql.org/docs/current/auth-pam.html><em>Si PAM est configuré pour lire /etc/shadow, l&rsquo;authentification échouera car le serveur PostgreSQL est démarré par un utilisateur non root. Cependant, ce n&rsquo;est pas un problème lorsque PAM est configuré pour utiliser LDAP ou d&rsquo;autres méthodes d&rsquo;authentification.</em> </a></p><h2 id=peer>Peer</h2><p>L&rsquo;authentification par les pairs est « <em><strong>identique</strong></em> » ; c&rsquo;est-à-dire, très semblable à l&rsquo;authentification ident! Les seules différences subtiles sont qu&rsquo;il n&rsquo;y a pas de serveurs d&rsquo;identification, et cette méthode fonctionne sur les connexions locales plutôt que sur TCP/IP.</p><p>L&rsquo;authentification par les pairs fournit un mécanisme pour mapper le nom d&rsquo;utilisateur du système d&rsquo;exploitation du client sur le nom d&rsquo;utilisateur de la base de données. Il a également la possibilité de mapper le nom d&rsquo;utilisateur. La configuration est très similaire à celle que nous avons configurée pour l&rsquo;authentification ident, sauf que la méthode d&rsquo;authentification est spécifiée en tant que « pair » au lieu de « ident ». </p><p>$ cat $PGDATA/pg_hba.conf</p><pre><code># TYPE  DATABASE        USER            ADDRESS                 METHOD
# &quot;local&quot; is for Unix domain socket connections only
local   all             all                                   peer map=PG_USER
# IPv4 local connections:
host    all             all             127.0.0.1/32            trust
</code></pre><pre><code>$ psql postgres -U postgres
2021-08-12 10:51:11.855 UTC [1976] LOG:  no match in usermap &quot;PG_USER&quot; for user &quot;postgres&quot; authenticated as &quot;vagrant&quot;
2021-08-12 10:51:11.855 UTC [1976] FATAL:  Peer authentication failed for user &quot;postgres&quot;
2021-08-12 10:51:11.855 UTC [1976] DETAIL:  Connection matched pg_hba.conf line 89: &quot;local   all             all                                     peer map=PG_USER&quot;
psql: error: connection to server on socket &quot;/tmp/.s.PGSQL.5432&quot; failed: FATAL:  Peer authentication failed for user &quot;postgres&quot;
</code></pre><p>La configuration de $PGDATA/pg_hba.conf ressemblera à ceci :</p><pre><code>$ cat $PGDATA/pg_hba.conf
# TYPE  DATABASE        USER            ADDRESS                 METHOD
# &quot;local&quot; is for Unix domain socket connections only

local   all             all                                     peer map=PG_USER
# IPv4 local connections:
</code></pre><p>$PGDATA/pg_ident.conf</p><pre><code># Put your actual configuration here
# ----------------------------------
# MAPNAME       SYSTEM-USERNAME         PG-USERNAME
PG_USER         vagrant                postgres
</code></pre><pre><code>vagrant@ubuntu-focal:~$ psql postgres -U postgres
psql (15devel)
Type &quot;help&quot; for help.
postgres=&gt;
</code></pre><h2 id=conclusion>Conclusion</h2><p>Nous avons couvert plusieurs méthodes d&rsquo;authentification différentes dans ce blog. Ces méthodes d&rsquo;authentification de base impliquent le serveur PostgreSQL, le noyau et le serveur d&rsquo;identification ; les options sont disponibles nativement sans aucune dépendance externe majeure. Il est toutefois important que la base de données soit correctement sécurisée pour empêcher tout accès non autorisé aux données.</p><h2 id=percona-distribution-for-postgresql-fournit-les-composants-dentreprise-les-meilleurs-et-les-plus-critiques-de-la-communauté-open-source-dans-une-seule-distribution-conçue-et-testée-pour-fonctionner-ensemble>Percona Distribution for PostgreSQL fournit les composants d&rsquo;entreprise les meilleurs et les plus critiques de la communauté open source dans une seule distribution, conçue et testée pour fonctionner ensemble.</h2><p><strong><a href=https://www.percona.com/software/postgresql-distribution>Telecharger Percona Distribution pour PostgreSQL</a></strong></p><p><strong>Source : <a href=https://www.percona.com/blog/postgresql-database-security-os-authentication/>Blog Percona</a></strong></p><ul class=pa0><li class=list><a href=/tags/postgresql class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">PostgreSQL</a></li></ul><div class="mt6 instapaper_ignoref"></div></div></article></main><footer class="bg-dark-blue bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.lesamisdepercona.fr/>&copy; Les amis de Percona 2022</a><div></div></div></footer></body></html>