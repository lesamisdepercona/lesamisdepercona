<!doctype html><html lang=fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Mise à niveau vers MySQL 8 : relever le défi | Les amis de Percona</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Traduit à partir de l'article de Mike Benshoof intitulé, Upgrading to MySQL 8 - Embrace the Challenge"><meta name=generator content="Hugo 0.80.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/ananke/css/main.min.css><link rel="shortcut icon" href=/img/favicon.png type=image/x-icon><meta property="og:title" content="Mise à niveau vers MySQL 8 : relever le défi"><meta property="og:description" content="Traduit à partir de l'article de Mike Benshoof intitulé, Upgrading to MySQL 8 - Embrace the Challenge"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lesamisdepercona.fr/posts/un-defi-mise-a-niveau-vers-mysql8/"><meta property="og:image" content="https://www.lesamisdepercona.fr/thumbnail/amisdepercona21-00010.jpg"><meta property="article:published_time" content="2021-08-08T11:43:01+04:00"><meta property="article:modified_time" content="2021-08-08T11:43:01+04:00"><meta itemprop=name content="Mise à niveau vers MySQL 8 : relever le défi"><meta itemprop=description content="Traduit à partir de l'article de Mike Benshoof intitulé, Upgrading to MySQL 8 - Embrace the Challenge"><meta itemprop=datePublished content="2021-08-08T11:43:01+04:00"><meta itemprop=dateModified content="2021-08-08T11:43:01+04:00"><meta itemprop=wordCount content="1125"><meta itemprop=image content="https://www.lesamisdepercona.fr/thumbnail/amisdepercona21-00010.jpg"><meta itemprop=keywords content="MySQL,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.lesamisdepercona.fr/thumbnail/amisdepercona21-00010.jpg"><meta name=twitter:title content="Mise à niveau vers MySQL 8 : relever le défi"><meta name=twitter:description content="Traduit à partir de l'article de Mike Benshoof intitulé, Upgrading to MySQL 8 - Embrace the Challenge"><script async src="https://www.googletagmanager.com/gtag/js?id=G-W9SYN1YL24"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-W9SYN1YL24');</script></head><body class="ma0 avenir bg-near-white"><header><div class=bg-dark-blue><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib"><img src=/img/logo.png class="w100 mw5-ns" alt="Les amis de Percona"></a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Articles page">Articles</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="Qui Sommes Nous? page">Qui Sommes Nous?</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/tags/ title="Tags page">Tags</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://www.lesamisdepercona.fr/posts/un-defi-mise-a-niveau-vers-mysql8/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://www.lesamisdepercona.fr/posts/un-defi-mise-a-niveau-vers-mysql8/&text=Mise%20%c3%a0%20niveau%20vers%20MySQL%208%20:%20relever%20le%20d%c3%a9fi" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.lesamisdepercona.fr/posts/un-defi-mise-a-niveau-vers-mysql8/&title=Mise%20%c3%a0%20niveau%20vers%20MySQL%208%20:%20relever%20le%20d%c3%a9fi" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Mise à niveau vers MySQL 8 : relever le défi</h1><p class=tracked>By <strong>Francis</strong></p><time class="f6 mv4 dib tracked" datetime=2021-08-08T11:43:01+04:00>August 8, 2021</time>
<span class="f6 mv4 dib tracked">- 6 minutes read</span>
<span class="f6 mv4 dib tracked">- 1125 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-100-l"><p>Personne n’aime le changement, surtout quand ce changement peut être difficile. Face à un défi technique, j’essaie de me souvenir de ce commentaire de Theodore Roosevelt : « <em>Rien au monde ne vaut la peine d’avoir ou de valoir la peine d’être fait sans effort, douleur, difficulté.</em>» Bien que ce soit un peu exagéré, dans ce cas, le concept principal est toujours valable. Nous ne devrions pas nous éloigner d’un chemin de mise à niveau car cela peut être difficile.</p><p><strong>MySQL 8.0 arrive à maturité et se stabilise</strong>. Il y a de nouvelles fonctionnalités (trop nombreuses pour être énumérées ici) et des améliorations de performances. De plus en plus d’organisations mettent à niveau vers MySQL 8 et l’exécutent en production, ce qui accélère la stabilisation. Bien qu’il y ait encore une piste importante sur 5.7 et qu’elle soit définitivement stable (EOL prévue pour octobre 2023), les organisations doivent se préparer à faire le saut si elles ne l’ont pas déjà fait.</p><h2 id=quest-ce-qui-a-changé>Qu’est ce qui a changé?</h2><p>Alors, en quoi une mise à niveau majeure vers la version 8.0 est-elle différente de celle des années précédentes? Honnêtement, ce n’est vraiment pas si différent. Le même processus général s’applique :</p><ol><li>Mise à niveau dans un environnement inférieur</li><li>Testez, testez, puis testez encore</li><li>Mettre à niveau un réplica et commencer à envoyer du trafic de lecture</li><li>Promouvoir un réplica en principal</li><li>Soyez prêt pour un retour en arrière si nécessaire</li></ol><p>Le dernier point est le plus gros changement, surtout une fois que vous avez terminé la mise à niveau vers MySQL 8. Historiquement, les mises à niveau de version mineures étaient assez triviales. Un simple arrêt d’instance, un échange binaire et un démarrage d’instance suffisaient pour revenir à une version précédente.</p><p>Dans la version 8.0, ce processus n’est plus pris en charge (comme indiqué dans la <a href=https://dev.mysql.com/doc/refman/8.0/en/downgrading.html>documentation officielle</a> )</p><p>« La mise à niveau de MySQL 8.0 vers MySQL 5.7, ou d’une version <strong>MySQL 8.0 vers une version précédente MySQL 8.0</strong> , n’est pas prise en charge. »</p><p>C’est un changement définitif dans le paradigme des versions, et cela a montré de réels problèmes dans les versions mineures. Un bon exemple de l’impact que cela peut avoir sur un système en direct a été bien capturé dans l’article de blog <a href=https://www.percona.com/blog/2020/01/10/mysql-8-minor-version-upgrades-are-one-way-only/>MySQL 8 Minor Version Upgrades Are ONE-WAY Only</a> à partir du début de 2020.</p><h2 id=comment-aborder-la-mise-à-niveau-vers-mysql-8>Comment aborder la mise à niveau vers MySQL 8</h2><p>Avec ce nouveau paradigme, il peut sembler effrayant de faire avancer la mise à niveau. Je pense qu’à certains égards, cela peut être un changement positif. Comme mentionné ci-dessus, une préparation et des tests appropriés devraient constituer la majorité du processus. La mise à niveau/le basculement réel devrait essentiellement être un non-événement. Il n’y a rien qu’un DBA aime plus que de finaliser une mise à niveau sans que personne ne le remarque (à part les améliorations potentielles).</p><p>Malheureusement, dans la pratique, les tests et la préparation appropriés sont généralement une réflexion après coup. Avec la facilité des mises à niveau (et en particulier les annulations), il était généralement plus facile de simplement «essayer et annuler si nécessaire». Comme les déclassements ne sont plus triviaux, cela devrait être considéré comme une opportunité en or d’améliorer la phase de préparation d’une mise à niveau.</p><p>Une attention supplémentaire devrait être accordée à :</p><ul><li>Examiner les notes de version en détail pour tout changement potentiel (les nouvelles fonctionnalités sont parfois activées par défaut dans la version 8.0)</li><li>Tester le système avec un trafic applicatif RÉEL (les benchmarks sont sympas, mais ne signifient rien s’ils sont génériques)</li><li>Solidifier le processus de sauvegarde et de restauration (c’est déjà parfait, non ?)</li><li>Examen de l’automatisation (cela signifie qu’il n’y a plus de mises à niveau automatisées «silencieuses»)</li><li>Le processus de mise à niveau réel (en commençant au bas de la chaîne de réplication et en maintenant les réplicas pour les annulations si nécessaire)</li></ul><p>Avec autant d’emphase sur la préparation, nous devrions, espérons-le, commencer à voir la mise à niveau réelle devenir moins impactante. Cela devrait également inspirer plus de confiance dans l’ensemble de l’organisation.</p><h2 id=quen-est-il-de-la-mise-en-échelle-at-scale>Qu’en est-il de «la mise en échelle (at scale)»?</h2><p>Ayant travaillé avec un large éventail de clients en tant que TAM, j’ai vu des environnements allant d’une seule paire primaire/réplique à des milliers de serveurs. J’admettrai librement qu’effectuer une mise à niveau de version majeure sur 10 000 serveurs n’est pas trivial. Rien n’est plus pénible que de devoir restaurer 5 000 serveurs lorsque quelque chose survient à mi-chemin du processus de mise à niveau. Bien qu’aucune quantité de tests ne puisse éliminer complètement cette possibilité, nous pouvons nous efforcer de minimiser le risque.</p><p>À cette échelle, tester les modèles de trafic réels est tellement plus critique. Lorsque vous examinez des environnements et des charges de travail complexes, la probabilité de rencontrer un cas limite augmente définitivement. L’identification de ces cas limites dans les environnements inférieurs est essentielle pour un processus de production fluide. De même, il est essentiel de s’assurer que des processus et des playbooks existent pour le retour en arrière (dans le cas où un problème apparaîtrait).</p><p>Enfin, le déploiement des mises à niveau par phases est également essentiel. En supposant que vous ayez mis en place une surveillance telle que <a href=https://www.percona.com/software/database-tools/percona-monitoring-and-management>Percona Monitoring and Management</a> , les tests et comparaisons A/B peuvent être inestimables. Voir les versions X et Y sur le même tableau de bord tout en servant le même trafic permet une bonne comparaison. Comparer X dans la mise en scène à Y dans la production est important, mais peut parfois être trompeur.</p><h3 id=conclusion>Conclusion</h3><p>Dans l’ensemble, la mise à niveau vers MySQL 8 n’est pas si différente des versions précédentes. Des précautions supplémentaires doivent être prises pendant la phase de préparation, mais cela doit être considéré comme un élément positif dans l’ensemble. Nous ne devrions certainement pas fuir le changement, mais plutôt l’embrasser car il doit éventuellement se produire. La pire chose qui puisse arriver est de continuer à avancer lentement, puis d’être pressé par le temps à l’approche de 5.7 EOL.</p><p>Pour solidifier la phase de préparation et de test, quels outils manquent selon vous ? Qu’est-ce qui faciliterait la relecture précise du trafic par rapport aux instances de test ? Bien qu’il existe des outils disponibles, y a-t-il quelque chose qui permettrait de s’assurer que ces meilleures pratiques sont suivies ?</p><p>Si votre organisation a besoin d’aide pour préparer ou terminer une mise à niveau, notre <a href=https://www.percona.com/services/consulting>équipe de services professionnels</a> peut être un atout précieux. De même, nos ingénieurs de support peuvent aider votre équipe lorsque vous rencontrez des cas extrêmes lors des tests.</p><p>Et, enfin, la stratégie la plus importante en matière de mises à niveau : le <strong>read-only Friday</strong> devrait être pris en consideration!</p><p>Source : <a href=https://www.percona.com/blog/2021/04/02/upgrading-to-mysql-8/>Percona Blog</a></p><ul class=pa0><li class=list><a href=/tags/mysql class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">MySQL</a></li></ul><div class="mt6 instapaper_ignoref"></div></div></article></main><footer class="bg-dark-blue bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.lesamisdepercona.fr/>&copy; Les amis de Percona 2021</a><div></div></div></footer></body></html>