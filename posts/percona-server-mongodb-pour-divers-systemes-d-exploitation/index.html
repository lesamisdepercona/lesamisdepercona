<!doctype html><html lang=fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Comment configurer Percona Server MongoDB pour divers systèmes d'exploitation? | Les amis de Percona</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Une guide pour testez vos modifications de code entre plateforme. A titre d'exemple, nous nous servirons de cette approche pour créer des packages/archives binaires Percona Server MongoDB pour tous les systèmes d'exploitation pris en charge"><meta name=generator content="Hugo 0.80.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/ananke/css/main.min.css><link rel="shortcut icon" href=/img/favicon.png type=image/x-icon><meta property="og:title" content="Comment configurer Percona Server MongoDB pour divers systèmes d'exploitation?"><meta property="og:description" content="Une guide pour testez vos modifications de code entre plateforme. A titre d'exemple, nous nous servirons de cette approche pour créer des packages/archives binaires Percona Server MongoDB pour tous les systèmes d'exploitation pris en charge"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lesamisdepercona.fr/posts/percona-server-mongodb-pour-divers-systemes-d-exploitation/"><meta property="og:image" content="https://www.lesamisdepercona.fr/thumbnail2022/article02.jpg"><meta property="article:published_time" content="2022-01-27T00:00:00+00:00"><meta property="article:modified_time" content="2022-01-27T00:00:00+00:00"><meta itemprop=name content="Comment configurer Percona Server MongoDB pour divers systèmes d'exploitation?"><meta itemprop=description content="Une guide pour testez vos modifications de code entre plateforme. A titre d'exemple, nous nous servirons de cette approche pour créer des packages/archives binaires Percona Server MongoDB pour tous les systèmes d'exploitation pris en charge"><meta itemprop=datePublished content="2022-01-27T00:00:00+00:00"><meta itemprop=dateModified content="2022-01-27T00:00:00+00:00"><meta itemprop=wordCount content="1110"><meta itemprop=image content="https://www.lesamisdepercona.fr/thumbnail2022/article02.jpg"><meta itemprop=keywords content="MongoDB,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.lesamisdepercona.fr/thumbnail2022/article02.jpg"><meta name=twitter:title content="Comment configurer Percona Server MongoDB pour divers systèmes d'exploitation?"><meta name=twitter:description content="Une guide pour testez vos modifications de code entre plateforme. A titre d'exemple, nous nous servirons de cette approche pour créer des packages/archives binaires Percona Server MongoDB pour tous les systèmes d'exploitation pris en charge"><script async src="https://www.googletagmanager.com/gtag/js?id=G-W9SYN1YL24"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-W9SYN1YL24');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-203534013-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-203534013-1');</script></head><body class="ma0 avenir bg-near-white"><header><div class=bg-dark-blue><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib"><img src=/img/logo.png class="w100 mw5-ns" alt="Les amis de Percona"></a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Articles page">Articles</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="Qui Sommes Nous? page">Qui Sommes Nous?</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/tags/ title="Tags page">Tags</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://www.lesamisdepercona.fr/posts/percona-server-mongodb-pour-divers-systemes-d-exploitation/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://www.lesamisdepercona.fr/posts/percona-server-mongodb-pour-divers-systemes-d-exploitation/&text=Comment%20configurer%20Percona%20Server%20MongoDB%20pour%20divers%20syst%c3%a8mes%20d%27exploitation?" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.lesamisdepercona.fr/posts/percona-server-mongodb-pour-divers-systemes-d-exploitation/&title=Comment%20configurer%20Percona%20Server%20MongoDB%20pour%20divers%20syst%c3%a8mes%20d%27exploitation?" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Comment configurer Percona Server MongoDB pour divers systèmes d'exploitation?</h1><p class=tracked>By <strong>Francis</strong></p><time class="f6 mv4 dib tracked" datetime=2022-01-27T00:00:00Z>January 27, 2022</time>
<span class="f6 mv4 dib tracked">- 6 minutes read</span>
<span class="f6 mv4 dib tracked">- 1110 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-100-l"><p><img src=/thumbnail2022/article02.jpg alt=thumbnail></p><p>Suite à cette série d&rsquo;articles de blog lancée par Evgeniy Patlan :</p><ul><li><a href=https://www.percona.com/blog/2017/01/20/how-to-manually-build-percona-server-rpm-packages/>Comment configurer manuellement Percona Server pour les packages MySQL RPM</a></li><li><a href=https://www.percona.com/blog/2021/03/10/how-to-build-percona-server-for-mysql-from-sources/>Comment créer un serveur Percona pour MySQL à partir de sources</a></li></ul><p>Nous vous montrerons comment créer <a href=https://www.percona.com/software/mongodb/percona-server-for-mongodb>Percona Server pour MongoDB </a>pour différents systèmes d&rsquo;exploitation <strong>¹</strong> en utilisant Docker sur votre machine/serveur de build Linux local. Dans ce cas précis, nous construirons des packages de <strong>Percona Server pour la version MongoDB 4.4.9-10</strong> pour <strong>Centos 8</strong> et <strong>Debian 11 ( bullseye )</strong> .</p><p>Cela peut être utile lorsque vous devez tester vos modifications du code pour différentes plates-formes basées sur RPM/DEB et vous assurer que tout fonctionne comme prévu dans différents environnements. Dans notre cas, cette approche est utilisée pour créer des packages/archives binaires Percona Server for MongoDB pour tous les systèmes d' exploitation pris en charge.</p><h2 id=préparer-lenvironnement>Préparer l&rsquo;environnement</h2><ul><li>Assurez-vous d&rsquo;avoir au moins 60 Go d&rsquo;espace disque libre</li><li>Créez un « dossier de construction » – le dossier où toutes les actions de construction seront effectuées, dans notre cas « <strong>/mnt/psmdb-44/test</strong> »</li><li>Assurez-vous que vous avez installé le package qui fournit <strong>docker</strong> et <strong>docker</strong> <strong>le service</strong> est opérationnel</li></ul><h2 id=obtenir-le-script-de-construction-de-la-version-requise>Obtenir le script de construction de la version requise²</h2><p>Vous devez télécharger le script de construction de la version nécessaire dans le dossier « <strong>/mnt/psmdb-44</strong> » :</p><pre><code>cd /mnt/psmdb-44/
wget https://raw.githubusercontent.com/percona/percona-server-mongodb/psmdb-4.4.9-10/percona-packaging/scripts/psmdb_builder.sh -O psmdb_builder.sh
</code></pre><h2 id=créer-un-serveur-percona-pour-larchive-source-mongodb>Créer un serveur Percona pour l&rsquo;archive source MongoDB</h2><ul><li>Veuillez noter que pour la création de l&rsquo;archive source , nous utilisons le plus ancien système d&rsquo;exploitation pris en charge, dans ce cas, il s&rsquo;agit de Centos 7.</li></ul><pre><code>docker run -ti -u root -v /mnt/psmdb-44:/mnt/psmdb-44 centos:7 sh -c '
set -o xtrace
cd /mnt/psmdb-44
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --install_deps=1
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --repo=https://github.com/percona/percona-server-mongodb.git \
--branch=release-4.4.9-10 --psm_ver=4.4.9 --psm_release=10 --mongo_tools_tag=100.4.1 --jemalloc_tag=psmdb-3.2.11-3.1 --get_sources=1
'
</code></pre><ul><li>Vérifiez que l&rsquo;archive source a été créée :</li></ul><pre><code>$ ls -la /mnt/psmdb-44/source_tarball/
total 88292
drwxr-xr-x. 2 root root     4096 Oct  1 10:58 .
drwxr-xr-x. 5 root root     4096 Oct  1 10:58 ..
-rw-r--r--. 1 root root 90398894 Oct  1 10:58 percona-server-mongodb-4.4.9-10.tar.gz
</code></pre><h2 id=construisez-le-serveur-percona-pour-le-rpmdeb-source-générique-mongodb>Construisez le serveur Percona pour le RPM/DEB source générique MongoDB :</h2><p>Veuillez noter que pour la création de sources génériques RPM/DEB, nous utilisons toujours le plus ancien système d&rsquo;exploitation basé sur RPM/DEB pris en charge, dans ce cas, Centos 7/ Ubuntu Xénial ( 16.04).</p><ul><li>Compiler le RPM source :</li></ul><pre><code>docker run -ti -u root -v /mnt/psmdb-44:/mnt/psmdb-44 centos:7 sh -c '
set -o xtrace
cd /mnt/psmdb-44
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --install_deps=1
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --repo=https://github.com/percona/percona-server-mongodb.git \
--branch=release-4.4.9-10 --psm_ver=4.4.9 --psm_release=10 --mongo_tools_tag=100.4.1 --jemalloc_tag=psmdb-3.2.11-3.1 --build_src_rpm=1
'
</code></pre><ul><li>Créez le DEB source :</li></ul><pre><code>docker run -ti -u root -v /mnt/psmdb-44:/mnt/psmdb-44 ubuntu:xenial sh -c '
set -o xtrace
cd /mnt/psmdb-44
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --install_deps=1
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --repo=https://github.com/percona/percona-server-mongodb.git \
--branch=release-4.4.9-10 --psm_ver=4.4.9 --psm_release=10 --mongo_tools_tag=100.4.1 --jemalloc_tag=psmdb-3.2.11-3.1 --build_src_deb=1
'
</code></pre><ul><li>Vérifiez que SRPM et Source DEB ont été créés :</li></ul><pre><code>$ ls -la /mnt/psmdb-44/srpm/
total 87480
drwxr-xr-x. 2 root root     4096 Oct  1 11:35 .
drwxr-xr-x. 6 root root     4096 Oct  1 11:35 ..
-rw-r--r--. 1 root root 89570312 Oct  1 11:35 percona-server-mongodb-4.4.9-10.generic.src.rpm

$ ls -la /mnt/psmdb-44/source_deb/
total 88312
drwxr-xr-x. 2 root root     4096 Oct  1 11:45 .
drwxr-xr-x. 7 root root     4096 Oct  1 11:45 ..
-rw-r--r--. 1 root root    10724 Oct  1 11:45 percona-server-mongodb_4.4.9-10.debian.tar.xz
-rw-r--r--. 1 root root     1528 Oct  1 11:45 percona-server-mongodb_4.4.9-10.dsc
-rw-r--r--. 1 root root     2075 Oct  1 11:45 percona-server-mongodb_4.4.9-10_source.changes
-rw-r--r--. 1 root root 90398894 Oct  1 11:45 percona-server-mongodb_4.4.9.orig.tar.gz
</code></pre><h2 id=créez-un-serveur-percona-pour-les-rpmdeb-mongodb>Créez un serveur Percona pour les RPM/DEB MongoDB :</h2><ul><li>Configurer RPM :</li></ul><pre><code>docker run -ti -u root -v /mnt/psmdb-44:/mnt/psmdb-44 centos:8 sh -c '
set -o xtrace
cd /mnt/psmdb-44
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --install_deps=1
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --repo=https://github.com/percona/percona-server-mongodb.git \
--branch=release-4.4.9-10 --psm_ver=4.4.9 --psm_release=10 --mongo_tools_tag=100.4.1 --jemalloc_tag=psmdb-3.2.11-3.1 --build_rpm=1
'
</code></pre><ul><li>Configurer DEB :</li></ul><pre><code>docker run -ti -u root -v /mnt/psmdb-44:/mnt/psmdb-44 debian:bullseye sh -c '
set -o xtrace
cd /mnt/psmdb-44
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --install_deps=1
bash -x ./psmdb_builder.sh --builddir=/mnt/psmdb-44/test --repo=https://github.com/percona/percona-server-mongodb.git \
--branch=release-4.4.9-10 --psm_ver=4.4.9 --psm_release=10 --mongo_tools_tag=100.4.1 --jemalloc_tag=psmdb-3.2.11-3.1 --build_deb=1
'
</code></pre><ul><li>Vérifiez que les RPM pour Centos 8 et les DEB pour Debian 11 ont été créés :</li></ul><pre><code>$  ls -la /mnt/psmdb-44/rpm/
total 1538692
drwxr-xr-x. 2 root root      4096 Oct  1 13:19 .
drwxr-xr-x. 9 root root      4096 Oct  1 13:19 ..
-rw-r--r--. 1 root root      8380 Oct  1 13:19 percona-server-mongodb-4.4.9-10.el8.x86_64.rpm
-rw-r--r--. 1 root root  19603132 Oct  1 13:19 percona-server-mongodb-debugsource-4.4.9-10.el8.x86_64.rpm
-rw-r--r--. 1 root root  16199100 Oct  1 13:19 percona-server-mongodb-mongos-4.4.9-10.el8.x86_64.rpm
-rw-r--r--. 1 root root 382301668 Oct  1 13:19 percona-server-mongodb-mongos-debuginfo-4.4.9-10.el8.x86_64.rpm
-rw-r--r--. 1 root root  37794568 Oct  1 13:19 percona-server-mongodb-server-4.4.9-10.el8.x86_64.rpm
-rw-r--r--. 1 root root 829718252 Oct  1 13:19 percona-server-mongodb-server-debuginfo-4.4.9-10.el8.x86_64.rpm
-rw-r--r--. 1 root root  13310328 Oct  1 13:19 percona-server-mongodb-shell-4.4.9-10.el8.x86_64.rpm
-rw-r--r--. 1 root root 218625728 Oct  1 13:19 percona-server-mongodb-shell-debuginfo-4.4.9-10.el8.x86_64.rpm
-rw-r--r--. 1 root root  30823056 Oct  1 13:19 percona-server-mongodb-tools-4.4.9-10.el8.x86_64.rpm
-rw-r--r--. 1 root root  27196024 Oct  1 13:19 percona-server-mongodb-tools-debuginfo-4.4.9-10.el8.x86_64.rpm

$  ls -la /mnt/psmdb-44/deb/
total 2335288
drwxr-xr-x. 2 root root       4096 Oct  1 13:16 .
drwxr-xr-x. 9 root root       4096 Oct  1 13:16 ..
-rw-r--r--. 1 root root 2301998432 Oct  1 13:16 percona-server-mongodb-dbg_4.4.9-10.bullseye_amd64.deb
-rw-r--r--. 1 root root   14872728 Oct  1 13:16 percona-server-mongodb-mongos_4.4.9-10.bullseye_amd64.deb
-rw-r--r--. 1 root root   35356944 Oct  1 13:16 percona-server-mongodb-server_4.4.9-10.bullseye_amd64.deb
-rw-r--r--. 1 root root   12274928 Oct  1 13:16 percona-server-mongodb-shell_4.4.9-10.bullseye_amd64.deb
-rw-r--r--. 1 root root   26784020 Oct  1 13:16 percona-server-mongodb-tools_4.4.9-10.bullseye_amd64.deb
-rw-r--r--. 1 root root      18548 Oct  4 13:16 percona-server-mongodb_4.4.9-10.bullseye_amd64.deb
</code></pre><p>Maintenant, les packages sont prêts à être installés pour tester/travailler sur Centos 8 et Debian 11.</p><p>Comme vous pouvez le voir ci-dessus, le processus de création de packages pour différents systèmes d&rsquo;exploitation est assez simple et ne nécessite pas beaucoup de machines physiques/virtuelles. Tout ce dont vous avez besoin est le script de construction et Docker.</p><p>De plus, comme vous l&rsquo;avez peut-être remarqué, toutes les commandes de construction sont similaires les unes aux autres, à l&rsquo;exception du dernier argument passé, qui définit l&rsquo;action à effectuer. Une telle approche nous permet d&rsquo;unifier le processus de construction et de le scripter afin que le dernier argument puisse être passé en paramètre au script. Certes, tous les autres arguments peuvent et doivent également être passés en tant que paramètres au cas où vous voudriez automatiser le processus de construction.</p><p><strong>¹ Systèmes</strong> d&rsquo;exploitation pris en charge (version psmdb-4.4.9-10) :</p><ul><li>Centos 7</li><li>Centos 8</li><li>Ubuntu Xénial ( 16.04)</li><li>Ubuntu Bionique ( 18.04)</li><li>Ubuntu Focale( 20.04)</li><li>Debian (9)</li><li>Debian Buster(10)</li><li>DebianName oeil de boeuf (11)</li></ul><p><strong>²</strong> Afin de configurer Percona Server pour MongoDB d&rsquo;une autre version, vous devez utiliser le script de construction de la version appropriée. Par exemple, il est nécessaire de configurer Percona Server pour MongoDB version 4.2.7-7 :</p><ul><li>Ouvrez notre repo sur <a href=https://github.com/percona/percona-server-mongodb>https://github.com/percona/percona-server-mongodb</a></li><li>Sélectionnez la version requise dans la liste des balises et basculez vers celle-ci (le lien pour ce cas sera le suivant : <a href=https://github.com/percona/percona-server-mongodb/tree/psmdb-4.2.7-7>https://github.com/percona/percona-server-mongodb/tree/psmdb-4.2.7-7 </a>)</li><li>Téléchargez le script de construction : <a href=https://raw.githubusercontent.com/percona/percona-server-mongodb/psmdb-4.2.7-7/percona-packaging/scripts/psmdb_builder.sh>https://raw.githubusercontent.com/percona/percona-server-mongodb/psmdb-4.2.7-7/percona-packaging/scripts/psmdb_builder.sh</a></li><li>Effectuez les étapes de la publication en utilisant le script de construction pour la version 4.2.7-7</li></ul><p>Source : <a href=https://www.percona.com/blog/how-to-build-percona-server-for-mongodb-for-various-operating-systems/>Percona Blog</a></p><ul class=pa0><li class=list><a href=/tags/mongodb class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">MongoDB</a></li></ul><div class="mt6 instapaper_ignoref"></div></div></article></main><footer class="bg-dark-blue bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.lesamisdepercona.fr/>&copy; Les amis de Percona 2022</a><div></div></div></footer></body></html>