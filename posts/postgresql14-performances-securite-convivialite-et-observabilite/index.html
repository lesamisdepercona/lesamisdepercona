<!doctype html><html lang=fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>PostgreSQL 14 – Performances, sécurité, convivialité et observabilité | Les amis de Percona</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="PostgreSQL 14: index B-tree, libpq, compression LZ4 à TOAST, parallélisme SQL, et Commodité pour les développeurs d'applications"><meta name=generator content="Hugo 0.80.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/ananke/css/main.min.css><link rel="shortcut icon" href=/img/favicon.png type=image/x-icon><meta property="og:title" content="PostgreSQL 14 – Performances, sécurité, convivialité et observabilité"><meta property="og:description" content="PostgreSQL 14: index B-tree, libpq, compression LZ4 à TOAST, parallélisme SQL, et Commodité pour les développeurs d'applications"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lesamisdepercona.fr/posts/postgresql14-performances-securite-convivialite-et-observabilite/"><meta property="og:image" content="https://www.lesamisdepercona.fr/thumbnail/thumbnailarticle25.jpg"><meta property="article:published_time" content="2021-11-19T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-19T00:00:00+00:00"><meta itemprop=name content="PostgreSQL 14 – Performances, sécurité, convivialité et observabilité"><meta itemprop=description content="PostgreSQL 14: index B-tree, libpq, compression LZ4 à TOAST, parallélisme SQL, et Commodité pour les développeurs d'applications"><meta itemprop=datePublished content="2021-11-19T00:00:00+00:00"><meta itemprop=dateModified content="2021-11-19T00:00:00+00:00"><meta itemprop=wordCount content="1308"><meta itemprop=image content="https://www.lesamisdepercona.fr/thumbnail/thumbnailarticle25.jpg"><meta itemprop=keywords content="PostgreSQL,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.lesamisdepercona.fr/thumbnail/thumbnailarticle25.jpg"><meta name=twitter:title content="PostgreSQL 14 – Performances, sécurité, convivialité et observabilité"><meta name=twitter:description content="PostgreSQL 14: index B-tree, libpq, compression LZ4 à TOAST, parallélisme SQL, et Commodité pour les développeurs d'applications"><script async src="https://www.googletagmanager.com/gtag/js?id=G-W9SYN1YL24"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-W9SYN1YL24');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-203534013-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-203534013-1');</script></head><body class="ma0 avenir bg-near-white"><header><div class=bg-dark-blue><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib"><img src=/img/logo.png class="w100 mw5-ns" alt="Les amis de Percona"></a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Articles page">Articles</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="Qui Sommes Nous? page">Qui Sommes Nous?</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/tags/ title="Tags page">Tags</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://www.lesamisdepercona.fr/posts/postgresql14-performances-securite-convivialite-et-observabilite/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://www.lesamisdepercona.fr/posts/postgresql14-performances-securite-convivialite-et-observabilite/&text=PostgreSQL%2014%20%e2%80%93%20Performances,%20s%c3%a9curit%c3%a9,%20convivialit%c3%a9%20et%20observabilit%c3%a9" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.lesamisdepercona.fr/posts/postgresql14-performances-securite-convivialite-et-observabilite/&title=PostgreSQL%2014%20%e2%80%93%20Performances,%20s%c3%a9curit%c3%a9,%20convivialit%c3%a9%20et%20observabilit%c3%a9" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">PostgreSQL 14 – Performances, sécurité, convivialité et observabilité</h1><p class=tracked>By <strong>Francis</strong></p><time class="f6 mv4 dib tracked" datetime=2021-11-19T00:00:00Z>November 19, 2021</time>
<span class="f6 mv4 dib tracked">- 7 minutes read</span>
<span class="f6 mv4 dib tracked">- 1308 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-100-l"><p>Aujourd&rsquo;hui a vu le lancement de PostgreSQL14. Pour moi, le domaine important sur lequel se concentrer est ce que la communauté a fait pour améliorer les performances des charges de travail transactionnelles lourdes et une prise en charge supplémentaire des données distribuées.</p><p>La quantité de données que les entreprises doivent traiter continue de croître de façon exponentielle. Être capable de monter en charge et de prendre en charge ces charges de travail sur PostgreSQL 14 grâce à une meilleure gestion des connexions simultanées et des fonctionnalités supplémentaires pour le parallélisme des requêtes est très judicieux pour les performances, tandis que l&rsquo;expansion de la réplication logique sera également utile.</p><h2 id=améliorations-des-performances>Améliorations des performances</h2><h3 id=améliorations-côté-serveur>Améliorations côté serveur</h3><h4 id=réduire-la-météorisation-de-lindex-b-tree>Réduire la météorisation de l&rsquo;index B-tree</h4><p>Les index fréquemment mis à jour ont tendance à avoir des tuples morts qui provoquent un gonflement des index. En règle générale, ces tuples ne sont supprimés que lorsqu&rsquo;un vide est exécuté. Entre les vides, au fur et à mesure que la page se remplit, une mise à jour ou une insertion provoquera une division de la page - quelque chose qui n&rsquo;est pas réversible. Cette division se produirait même si les tuples morts à l&rsquo;intérieur de la page existante auraient pu être supprimés, laissant de la place pour des tuples supplémentaires.</p><p>PostgreSQL 14 implémente l&rsquo;amélioration où les tuples morts sont détectés et supprimés même entre les vides, permettant un nombre réduit de fractionnements de page, réduisant ainsi le gonflement de l&rsquo;index.</p><h4 id=supprimer-avec-empressement-les-pages-b-tree>Supprimer avec empressement les pages B-tree</h4><p>En réduisant les frais généraux des B-tree, le système d&rsquo;aspiration a été amélioré pour supprimer rapidement les pages supprimées. Auparavant, il fallait 2 cycles de vide pour le faire, le premier marquant la page comme supprimée et le second libérant réellement cet espace.</p><h3 id=améliorations-pour-les-cas-dutilisation-spécialisés>Améliorations pour les cas d&rsquo;utilisation spécialisés</h3><h4 id=mode-pipeline-pour-libpq>Mode pipeline pour libpq</h4><p>Les connexions à latence élevée avec des opérations d&rsquo;écriture fréquentes peuvent ralentir les performances du client car libpq attend que chaque transaction soit réussie avant d&rsquo;envoyer la suivante. Avec PostgreSQL 14, le « mode pipeline » a été introduit dans libpq, permettant au client d&rsquo;envoyer plusieurs transactions en même temps, ce qui donne potentiellement un énorme coup de pouce aux performances. De plus, puisqu&rsquo;il s&rsquo;agit d&rsquo;une fonctionnalité côté client, la libpq de PostgreSQL 14 peut même être utilisée avec les anciennes versions du serveur PostgreSQL.</p><h4 id=réplication-des-transactions-en-cours>Réplication des transactions en cours</h4><p>La réplication logique a été étendue pour permettre le streaming des transactions en cours aux abonnés. Les transactions volumineuses étaient auparavant écrites sur le disque jusqu&rsquo;à ce que la transaction soit terminée avant d&rsquo;être répliquées vers l&rsquo;abonné. En permettant la diffusion en continu des transactions en cours, les utilisateurs bénéficient d&rsquo;importants avantages en termes de performances et d&rsquo;une plus grande confiance dans leurs charges de travail distribuées.</p><h4 id=ajouter-la-compression-lz4-à-toast>Ajouter la compression LZ4 à TOAST</h4><p>PostgreSQL 14 ajoute la prise en charge de la compression LZ4 pour TOAST, un système utilisé pour stocker efficacement des données volumineuses. LZ4 est un algorithme de compression sans perte qui se concentre sur la vitesse de compression et de décompression. LZ4 peut être configuré au niveau de la colonne ainsi qu&rsquo;au niveau du système. Auparavant, la seule option était la compression pglz - qui est rapide mais a un faible taux de compression.</p><h3 id=améliorations-pour-les-charges-de-travail-distribuées>Améliorations pour les charges de travail distribuées</h3><p>Le wrapper de données étrangères PostgreSQL - postgres_fdw - a contribué à alléger le fardeau de la gestion des charges de travail distribuées. Avec PostgreSQL 14, il y a 2 améliorations majeures dans le FDW pour améliorer les performances de ces transactions : le parallélisme des requêtes peut désormais être exploité pour <a href=https://www.percona.com/blog/2021/06/02/postgres_fdw-enhancement-in-postgresql-14/>les analyses de tables parallèles sur les tables étrangères</a> , et l' <a href=https://www.percona.com/blog/2021/05/27/new-features-in-postgresql-14-bulk-inserts-for-foreign-data-wrappers/>insertion en bloc de données est désormais autorisée sur les tables étrangères</a> .  </p><p>Ces deux améliorations renforcent la capacité croissante de PostgreSQL à évoluer horizontalement et à gérer nativement les bases de données distribuées.</p><h4 id=amélioration-du-parallélisme-sql>Amélioration du parallélisme SQL</h4><p>La prise en charge par PostgreSQL du parallélisme des requêtes permet au système d&rsquo;engager plusieurs cœurs de processeur dans plusieurs threads pour exécuter des requêtes en parallèle, améliorant ainsi considérablement les performances. PostgreSQL 14 apporte plus de raffinement à ce système en ajoutant la prise en charge de RETURN QUERY et REFRESH MATERIALIZED VIEW pour exécuter des requêtes en parallèle. Des améliorations ont également été apportées aux performances des analyses séquentielles parallèles et des jointures en boucle imbriquées.</p><h2 id=sécurité>Sécurité</h2><h3 id=scram-comme-authentification-par-défaut>SCRAM comme authentification par défaut</h3><p>L&rsquo;authentification SCRAM-SHA-256 a été introduite dans PostgreSQL 10 et est maintenant devenue l&rsquo;authentification par défaut dans PostgreSQL 14. L&rsquo;authentification par défaut MD5 précédente avait quelques faiblesses qui ont été exploitées dans le passé. SCRAM est beaucoup plus puissant et permet une conformité réglementaire plus facile pour la sécurité des données.</p><h3 id=rôles-prédéfinis>Rôles prédéfinis</h3><p>Deux rôles prédéfinis ont été ajoutés dans PostgreSQL 14 – pg_read_all_data et pg_write_all_data. Le premier permet d&rsquo;accorder à un utilisateur un accès en lecture seule à toutes les tables, vues et schémas de la base de données. Ce rôle aura un accès en lecture par défaut à toutes les nouvelles tables créées. Ce dernier permet de créer des privilèges de style super-utilisateur, ce qui signifie qu&rsquo;il faut être très prudent lors de son utilisation !</p><h2 id=commodité-pour-les-développeurs-dapplications>Commodité pour les développeurs d&rsquo;applications</h2><h3 id=accéder-à-json-à-laide-dindices>Accéder à JSON à l&rsquo;aide d&rsquo;indices</h3><p>Du point de vue du développement d&rsquo;applications, j&rsquo;ai toujours trouvé la prise en charge de JSON dans PostgreSQL très intéressante. PostgreSQL prend en charge ce formulaire de données non structuré depuis la version 9.2, mais il a une syntaxe unique pour récupérer les données. Dans la version 14, la prise en charge des indices a été ajoutée, ce qui permet aux développeurs de récupérer plus facilement les données JSON à l&rsquo;aide d&rsquo;une syntaxe communément reconnue. Pour plus d&rsquo;informations, Matt Yonkovit a récemment rédigé le post <a href=https://www.percona.com/blog/using-new-json-syntax-in-postgresql-14-update/>Utilisation de la nouvelle syntaxe JSON dans PostgreSQL 14 que</a> vous devriez consulter.</p><h3 id=types-multigamme>Types multigamme</h3><p>PostgreSQL a des types Range depuis la version 9.2. PostgreSQL 14 introduit désormais la prise en charge « multiplage » qui permet des plages non contiguës, aidant les développeurs à écrire des requêtes plus simples pour des séquences complexes. Un exemple simple d&rsquo;utilisation pratique serait de spécifier les plages horaires pendant lesquelles une salle de réunion est réservée au cours de la journée. Voir le post de Matt Yonkovit sur <a href=https://www.percona.com/blog/using-the-multirange-data-type-in-postgresql-14/>les types de données multiplages dans PostgreSQL 14</a> pour plus d&rsquo;informations.  </p><h3 id=paramètres-out-dans-les-procédures-stockées>Paramètres OUT dans les procédures stockées</h3><p>Des procédures stockées ont été ajoutées dans PostgreSQL 11, donnant aux développeurs un contrôle transactionnel dans un bloc de code. PostgreSQL 14 implémente le paramètre OUT, permettant aux développeurs de renvoyer des données en utilisant plusieurs paramètres dans leurs procédures stockées. Cette fonctionnalité sera familière aux développeurs Oracle et bienvenue pour les personnes essayant de migrer d&rsquo;Oracle vers PostgreSQL.</p><h2 id=observabilité>Observabilité</h2><p>L&rsquo;observabilité est l&rsquo;un des plus grands mots à la mode de 2021, car les développeurs veulent plus d&rsquo;informations sur les performances de leurs applications au fil du temps. PostgreSQL 14 ajoute plus de fonctionnalités pour aider à la surveillance, l&rsquo;un des changements les plus importants étant le déplacement du système de hachage des requêtes de pg_stat_statement vers la base de données principale. Cela permet de surveiller une requête à l&rsquo;aide d&rsquo;un seul ID sur plusieurs systèmes PostgreSQL et fonctions de journalisation. Cette version ajoute également de nouvelles fonctionnalités pour suivre la progression des statistiques de COPY, d&rsquo;activité WAL et de slots de réplication.</p><p>Ce qui précède est un petit sous-ensemble des plus de 200 fonctionnalités et améliorations qui composent la version PostgreSQL 14. Dans l&rsquo;ensemble, cette mise à jour de version aidera PostgreSQL à continuer de dominer le secteur des bases de données open source.</p><p>Alors que de plus en plus d&rsquo;entreprises envisagent de migrer loin d&rsquo;Oracle ou de mettre en œuvre de nouvelles bases de données avec leurs applications, PostgreSQL est souvent la meilleure option pour ceux qui souhaitent s&rsquo;exécuter sur des bases de données open source.</p><p><strong>Source : <a href=https://www.percona.com/blog/postgresql-14-performance-security-usability-and-observability/>Blog Percona</a></strong></p><ul class=pa0><li class=list><a href=/tags/postgresql class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">PostgreSQL</a></li></ul><div class="mt6 instapaper_ignoref"></div></div></article></main><footer class="bg-dark-blue bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.lesamisdepercona.fr/>&copy; Les amis de Percona 2021</a><div></div></div></footer></body></html>