<!doctype html><html lang=fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Mis au point des paramètres de configuration MySQL 8 | Les amis de Percona</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Traduit à partir de l'article de Brian Sumpter intitulé, Easily Validate Configuration Settings in MySQL 8"><meta name=generator content="Hugo 0.80.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/ananke/css/main.min.css><link rel="shortcut icon" href=/img/favicon.png type=image/x-icon><meta property="og:title" content="Mis au point des paramètres de configuration MySQL 8"><meta property="og:description" content="Traduit à partir de l'article de Brian Sumpter intitulé, Easily Validate Configuration Settings in MySQL 8"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lesamisdepercona.fr/posts/mis-au-point-des-param%C3%A8tres-de-configuration-mysql8/"><meta property="og:image" content="https://www.lesamisdepercona.fr/thumbnail/amisdepercona21-00011.jpg"><meta property="article:published_time" content="2021-08-13T11:43:01+04:00"><meta property="article:modified_time" content="2021-08-13T11:43:01+04:00"><meta itemprop=name content="Mis au point des paramètres de configuration MySQL 8"><meta itemprop=description content="Traduit à partir de l'article de Brian Sumpter intitulé, Easily Validate Configuration Settings in MySQL 8"><meta itemprop=datePublished content="2021-08-13T11:43:01+04:00"><meta itemprop=dateModified content="2021-08-13T11:43:01+04:00"><meta itemprop=wordCount content="830"><meta itemprop=image content="https://www.lesamisdepercona.fr/thumbnail/amisdepercona21-00011.jpg"><meta itemprop=keywords content="MySQL,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.lesamisdepercona.fr/thumbnail/amisdepercona21-00011.jpg"><meta name=twitter:title content="Mis au point des paramètres de configuration MySQL 8"><meta name=twitter:description content="Traduit à partir de l'article de Brian Sumpter intitulé, Easily Validate Configuration Settings in MySQL 8"><script async src="https://www.googletagmanager.com/gtag/js?id=G-W9SYN1YL24"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-W9SYN1YL24');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-203534013-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-203534013-1');</script></head><body class="ma0 avenir bg-near-white"><header><div class=bg-dark-blue><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib"><img src=/img/logo.png class="w100 mw5-ns" alt="Les amis de Percona"></a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Articles page">Articles</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="Qui Sommes Nous? page">Qui Sommes Nous?</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/tags/ title="Tags page">Tags</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://www.lesamisdepercona.fr/posts/mis-au-point-des-param%C3%A8tres-de-configuration-mysql8/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://www.lesamisdepercona.fr/posts/mis-au-point-des-param%C3%A8tres-de-configuration-mysql8/&text=Mis%20au%20point%20des%20param%c3%a8tres%20de%20configuration%20MySQL%208" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.lesamisdepercona.fr/posts/mis-au-point-des-param%C3%A8tres-de-configuration-mysql8/&title=Mis%20au%20point%20des%20param%c3%a8tres%20de%20configuration%20MySQL%208" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Mis au point des paramètres de configuration MySQL 8</h1><p class=tracked>By <strong>Francis</strong></p><time class="f6 mv4 dib tracked" datetime=2021-08-13T11:43:01+04:00>August 13, 2021</time>
<span class="f6 mv4 dib tracked">- 4 minutes read</span>
<span class="f6 mv4 dib tracked">- 830 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-100-l"><p>Dans les versions précédentes de MySQL, il y avait souvent une &ldquo;valse de mise à niveau&rdquo; qui devait être exécutée lors du démarrage d&rsquo;une instance MySQL nouvellement mise à niveau avec le fichier de configuration de la version précédente. Dans certains cas, quelques options obsolètes peuvent ne plus être prises en charge dans la nouvelle version du serveur, déclenchant ainsi une erreur et un arrêt quelques instants après le démarrage. La même chose peut se produire même en dehors des scénarios de mise à niveau si une modification de configuration a été apportée avec une erreur ou une faute de frappe dans le nom ou la valeur d’une variable.</p><p>Depuis MySQL 8.0.16 et versions ultérieures, il existe désormais une option ' <strong>validate- config &lsquo;</strong> pour tester et valider rapidement les options de configuration du serveur sans avoir à démarrer le serveur. Une fois utilisé, si aucun problème n&rsquo;est trouvé avec le fichier de configuration, le serveur se fermera avec un code de sortie zéro (0). Si un problème est détecté, le serveur se fermera avec un code d&rsquo;erreur un (1) pour la première circonstance de tout ce qui est déterminé comme non valide.</p><h2 id=validation-single-option><strong>Validation Single Option</strong></h2><p>Par exemple, considérons l&rsquo;option de serveur suivante ( old_passwords ) qui a été supprimée dans MySQL 8 :</p><pre><code>./mysqld --old_passwords=1 --validate-config
2021-03-25T17:56:49.932782Z 0 [ERROR] [MY-000067] [Server] unknown variable 'old_passwords=1'.
2021-03-25T17:56:49.932862Z 0 [ERROR] [MY-010119] [Server] Aborting
</code></pre><p>Notez que le serveur s&rsquo;est terminé avec un code d&rsquo;erreur un (1) et affiche l&rsquo;erreur pour l&rsquo;option invalide.</p><h2 id=validation-dun-fichier-de-configuration><strong>Validation d’un fichier de configuration</strong></h2><p>Il est également possible de valider un fichier de configuration my.cnf entier pour vérifier toutes les options :</p><pre><code>./mysqld --defaults-file=/home/sandbox/my.cnf --validate-config
2021-03-25T18:03:41.938734Z 0 [ERROR] [MY-000067] [Server] unknown variable 'old_passwords=1'.
2021-03-25T18:03:41.938865Z 0 [ERROR] [MY-010119] [Server] Aborting
</code></pre><p>Notez que le serveur s&rsquo;est arrêté à la <strong>première occurrence</strong> d&rsquo;une valeur non valide. Toutes les erreurs restantes dans le fichier de configuration devront être trouvées après avoir corrigé la première erreur et exécuté à nouveau l&rsquo;option <strong>validate-config</strong> . Donc, dans cet exemple, j&rsquo;ai maintenant supprimé l&rsquo; option ' <strong>old_passwords =1</strong> ' dans le fichier de configuration, et je dois réexécuter <strong>validate-config</strong> pour voir s&rsquo;il reste d&rsquo;autres erreurs.</p><pre><code>./mysqld --defaults-file=/home/sandbox/my.cnf --validate-config
2021-03-25T18:08:28.612912Z 0 [ERROR] [MY-000067] [Server] unknown variable 'query_cache_size=41984'.
2021-03-25T18:08:28.612980Z 0 [ERROR] [MY-010119] [Server] Aborting
</code></pre><p>En effet, il y a encore une autre option qui a été supprimée de MySQL 8 dans le fichier de configuration, donc après avoir ré-exécuté la validation (après avoir corrigé le premier problème), nous avons maintenant identifié un deuxième problème. Après avoir supprimé l&rsquo;option <strong>query_cache_size</strong> du fichier my.cnf et exécuté à nouveau <strong>validate- config</strong> , nous obtenons enfin une configuration soignée.</p><pre><code>./mysqld --defaults-file=/home/sandbox/my.cnf --validate-config
</code></pre><h2 id=modifier-la-verbosité-de-la-validation><strong>Modifier la verbosité de la validation</strong></h2><p>Par défaut, l’option <strong>validate-config</strong> ne rapportera que les messages d&rsquo;erreur. Si vous souhaitez également voir des avertissements ou des messages d&rsquo;information, vous pouvez modifier <strong>log_error_verbosity</strong> avec une valeur supérieure à un (1) :</p><pre><code>./mysqld --defaults-file=/home/sandbox/my.cnf --log-error-verbosity=2 --validate-config
2021-03-25T18:20:01.380727Z 0 [Warning] [MY-000076] [Server] option 'read_only': boolean value 'y' was not recognized. Set to OFF.
</code></pre><p>Maintenant, nous voyons des messages de niveau d&rsquo;avertissement, et le serveur renvoi un code d&rsquo;erreur zéro (0) car il n&rsquo;y a techniquement aucune erreur, seulement des avertissements. Pour aller plus loin, j&rsquo;ai ajouté l' option <strong>query_cache_size</strong> d&rsquo;en haut dans le fichier my.cnf, et si nous exécutons à nouveau la validation, nous voyons à la fois des erreurs et des avertissements cette fois, tandis que le serveur se ferme avec un code d&rsquo;erreur un (1) car il y a vraiment eu une erreur :</p><pre><code>./mysqld --defaults-file=/home/sandbox/my.cnf --log-error-verbosity=2 --validate-config
2021-03-25T18:23:11.364288Z 0 [Warning] [MY-000076] [Server] option 'read_only': boolean value 'y' was not recognized. Set to OFF.
2021-03-25T18:23:11.372729Z 0 [ERROR] [MY-000067] [Server] unknown variable 'old_passwords=1'.
2021-03-25T18:23:11.372795Z 0 [ERROR] [MY-010119] [Server] Aborting
</code></pre><h2 id=ancienne-version-alternative><strong>Ancienne version alternative</strong></h2><p>Lors de mes tests de la fonctionnalité <strong>validate_config,</strong> un collègue a souligné qu&rsquo;il existe un moyen de répliquer cette validation sur les anciennes versions de MySQL en utilisant une combinaison d&rsquo;options « help » et « verbose » comme ci-dessous :</p><pre><code>$ mysqld --defaults-file=/tmp/my.cnf --verbose --help 1&gt;/dev/null; echo $?
0
 
$ echo default_table_encryption=OFF &gt;&gt; /tmp/my.cnf
 
$ mysqld --defaults-file=/tmp/my.cnf --verbose --help 1&gt;/dev/null; echo $?
2021-03-26T08:43:04.987265Z 0 [ERROR] unknown variable 'default_table_encryption=OFF'
2021-03-26T08:43:04.990898Z 0 [ERROR] Aborting
1
 
$ mysqld --version
mysqld  Ver 5.7.33-36 for Linux on x86_64 (Percona Server (GPL), Release 36, Revision 7e403c5)
</code></pre><h2 id=pour-conclure><strong>Pour Conclure</strong></h2><p>Bien qu&rsquo;elle ne soit pas parfaite, la fonctionnalité <strong>validate-config</strong> contribue grandement à faciliter la gestion des mises à niveau et des modifications de configuration. Il est maintenant possible de savoir avec une certaine certitude que vos fichiers de configuration ou vos options sont valides avant de redémarrer le serveur et de trouver le problème qui finit par empêcher votre nœud de démarrer normalement, ce qui entraîne un temps d&rsquo;arrêt inattendu.</p><p><strong>Percona Distribution for MySQL est la solution MySQL open source la plus complète, stable, évolutive et sécurisée disponible, offrant des environnements de base de données de niveau entreprise pour vos applications et métier les plus exigeant … son utilisation est gratuite !</strong></p><p><strong>Télécharger <a href=https://www.percona.com/software/mysql-database>Percona Distribution MySQL**</a></strong></p><p>Article original : <a href=https://www.percona.com/blog/2021/04/01/easily-validate-configuration-settings-in-mysql-8/>Percona</a></p><ul class=pa0><li class=list><a href=/tags/mysql class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">MySQL</a></li></ul><div class="mt6 instapaper_ignoref"></div></div></article></main><footer class="bg-dark-blue bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.lesamisdepercona.fr/>&copy; Les amis de Percona 2022</a><div></div></div></footer></body></html>